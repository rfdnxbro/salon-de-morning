# リポジトリガイドライン

本リポジトリは初期セットアップ中です。コミュニケーション、コメント、ドキュメント、コミットメッセージは日本語で行います。

## 📘 Notion仕様書

プロジェクトの詳細な仕様書はNotionで管理されています：
**https://www.notion.so/2557e05887d680619916c4496bdafc54**

### 重要な指針
- **実装前に必ず仕様書を確認してください**
- **技術要件やアーキテクチャの変更時は、Notion仕様書も更新してください**
- 仕様書には以下の情報が記載されています：
  - サービス概要と解決する社会課題
  - ビジネスモデルと収益構造
  - システムアーキテクチャと技術スタック
  - 4アプリ構成の詳細
  - 今後の検討事項と拡張計画

## サービス要約
- **サービス名**: 「サロン de モーニング」。地域のカフェや公民館の早朝時間を活用し、移動しづらい高齢者などが日常動線のまま医療・生活支援を受けられる場を提供する。
- **コンセプト**: 「役割のハイブリッド」。既存ステークホルダー（利用者・カフェ・医療機関）が従来の役割に加えて新たな機能を持ち、医療・相談・買い物を同一拠点で完結できる仕組みを目指す。
- **解決したい課題**: 交通弱者の移動負担、医療機関へのアクセス困難、カフェのアイドルタイム活用、医療機関の新規患者獲得などを包括的に解消する。
- **収益モデル**: 医療機関向けに成果報酬プランと月額固定プランを用意し、カフェ側は参加無料とする。医療・薬局ネットワークへのアクセスや現役医師のコネクションを競争優位とする。
- **展開ロードマップ**: 0→3フェーズで津島市の実証から同一オーナー店舗、地域70拠点、愛知県全域〜全国6000拠点規模まで段階的に拡大する計画。
- **プラットフォーム機能要件**: Web上での検索・予約・スケジュール管理、医療機関とカフェのマッチングがコア。利用者向け医療相談、カフェ向け集客・収益化、医療機関向け潜在患者接点が主要ユースケース。
- **今後の検討事項**: 移動販売車の誘致やオンライン診療との連携、企業向け健康相談、匿名データ活用、調剤薬局・自治体との協業、高齢者見守り連携など拡張余地が示されている。

## プロジェクト構成
- ソースコード: `src/`（機能単位のフォルダ）。共有ユーティリティは `src/shared/`。
- テスト: `tests/` に配置し、`src/` の構造をミラー。
- ドキュメント: `docs/`、静的アセット: `assets/`。
- ルートに各種設定（リンター・フォーマッタ・ツール）の設定ファイルを置く。

## ビルド・テスト・開発コマンド
- ビルド: `make build`（技術スタック確定後に整備）。
- テスト: `make test` / `npm test` / `pytest` などスタックに応じて。
- Lint/Format: `make lint` / `make fmt`。
- 開発サーバ: `make dev`（例: `npm run dev`）。
Makefile やパッケージスクリプトは自己説明的なターゲット名にし、READMEに簡潔に記載してください。

## コーディング規約
- インデントは2スペース、行幅は概ね100桁。
- 命名: Webフロントのファイルは kebab-case、Python は snake_case、型/クラスは PascalCase。
- 小さな純粋関数・疎結合モジュールを優先し、「巨大ファイル」を避ける。
- フォーマッタ/リンタ（例: Prettier/ESLint, Black/Ruff）が有効な場合は従う（手で崩さない）。

## テスト指針
- 単体テストは `tests/` に配置。`foo.test.ts` / `test_foo.py` のような命名。
- 高速で決定的なテストを重視。重要経路と境界値をカバー。
- PR 前に全テストをローカル実行し、必要に応じてカバレッジを確認。

## コミット・PR ガイドライン
- コミット: 短い命令形の日本語サマリ。`#123` のようにIssueを参照。
- 変更は小さく論理的に分割し、無関係な修正の抱き合わせを避ける。
- PR: 背景・目的を記述し、UI 変更はスクリーンショットを添付。該当する Notion 節へのリンクを含める。
- チェックリスト: CI 通過、テスト更新、挙動変更時はドキュメント更新。

## ブランチ戦略（新機能開発）
- 基本の流れ: 「ブランチ作成 → 開発 → PR → Merge → `main` へ戻って最新化 → ブランチ削除（ローカル/リモート）」
- 作業開始前に `main` を最新化する。
  - `git checkout main && git pull origin main`
- 新機能ごとにブランチを切る（例: `feature/123-短い説明`）。
  - `git switch -c feature/<issue-number>-<slug>`
- 実装し、適切にコミットしてリモートへ初回プッシュ。
  - `git push -u origin feature/<issue-number>-<slug>`
- GitHub 上で PR を作成し、レビュワーをアサイン。該当 Notion 節へのリンクを含める。
- PR が merge されたら、ローカルで `main` に戻り最新を取得。
  - `git checkout main && git pull origin main`
- 使い終わったブランチを削除。
  - ローカル: `git branch -d feature/<issue-number>-<slug>`
  - リモート: `git push origin --delete feature/<issue-number>-<slug>`
  - 参照整理（任意）: `git fetch -p`

## セキュリティ・設定
- 秘密情報はコミットしない。`.env.local` を使用し、必要キーは `.env.example` で共有。
- 追加した設定フラグは `docs/config.md` に記録。

## アクセシビリティ設計（最重要）

**本サービスの主要ユーザーは高齢者です。特に一般ユーザー向けアプリ（`apps/user`）では、以下のアクセシビリティ要件を必ず遵守してください。**

管理向けアプリ（`apps/admin`、`apps/store`、`apps/client`）は基本的な可読性・操作性を確保しつつ、業務利用を前提とした標準的な文字サイズ（ベース16px想定）とUI密度で設計して構いません。大きなフォントや広いタップ領域は `apps/user` を最優先とし、他アプリは必要に応じて個別要望があった場合に拡大対応します。

### 視覚的要件
- **文字サイズ**: ベース16px、推奨18px以上、重要情報20px以上
- **コントラスト**: WCAG AA基準（4.5:1）必須、AAA基準（7:1）推奨
- **タップ領域**: 最小48x48px、余白8px以上
- **フォント**: 游ゴシック、メイリオなど読みやすい日本語フォント
- **色彩設計**: 色のみでの情報伝達禁止（形状・テキスト併用）

### インタラクション設計
- **ナビゲーション**: 階層を浅く、直感的な導線
- **フィードバック**: 明確なホバー、フォーカス、押下状態
- **エラー処理**: 具体的で優しい日本語メッセージ
- **確認ダイアログ**: 破壊的操作には必須
- **ローディング**: 視覚的に明確な待機表示
- **タイムアウト**: 十分な操作時間（最小30秒）

### 技術実装
- **セマンティックHTML**: 適切な要素選択（`<button>`, `<nav>`, `<main>`等）
- **ARIA属性**: `aria-label`, `aria-describedby`等の適切な使用
- **キーボード対応**: Tab順序、Enter/Space操作の完全サポート
- **フォーカス管理**: 視覚的に明確なフォーカスインジケーター
- **画像**: 必ず`alt`属性を設定
- **フォーム**: ラベルとの明確な関連付け、エラーの即座通知

### テスト推奨事項
- スクリーンリーダー（NVDA/JAWS）での動作確認
- キーボードのみでの全機能操作確認
- 拡大表示（200%）での表示崩れチェック
- 色覚多様性シミュレーター使用

## エージェント向けメモ
- 変更は最小・可逆に保ち、理由をPRで簡潔に説明。
- 仕様に曖昧さがある場合は Notion を参照し、早めに相談してください。
- **アクセシビリティ要件は`apps/user`で妥協せず、高齢者の使いやすさを最優先に考えてください。**
- 全アプリの公開環境は検索エンジン向けにインデックスさせない。`index.html` へ `meta name="robots" content="noindex"` を維持すること。
